<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Préstamos</title>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Gestión de Préstamos</h1>
            <p>Administra préstamos y controla los pagos de manera eficiente</p>
        </div>

        <div class="content">
            <div class="stats-cards">
                <div class="stat-card">
                    <h3>Total Préstamos</h3>
                    <div class="value" id="totalLoans">{{ totalPrestamos() }}</div>
                </div>
                <div class="stat-card">
                    <h3>Monto Total</h3>
                    <div class="value" id="totalAmount">{{ calcularMontoTotal() | number:'1.2-2' }}</div>
                </div>
                <div class="stat-card">
                    <h3>Pendientes</h3>
                    <div class="value" id="pendingLoans">{{ totalPendientes() }}</div>
                </div>
                <div class="stat-card">
                    <h3>Pagados</h3>
                    <div class="value" id="paidLoans">{{ totalPagados() }}</div>
                </div>
            </div>

            <div class="search-container">
                <div class="search-wrapper">
                    <input type="text" class="search-input" placeholder="Buscar préstamo por cliente o descripción..."
                        id="searchInput">
                    <svg class="search-icon" viewBox="0 0 24 24">
                        <path
                            d="M21.53 20.47l-3.66-3.66C19.195 15.24 20 13.214 20 11c0-4.97-4.03-9-9-9s-9 4.03-9 9 4.03 9 9 9c2.215 0 4.24-.804 5.808-2.13l3.66 3.66c.147.146.34.22.53.22s.385-.073.53-.22c.295-.293.295-.767.002-1.06zM3.5 11c0-4.135 3.365-7.5 7.5-7.5s7.5 3.365 7.5 7.5-3.365 7.5-7.5 7.5-7.5-3.365-7.5-7.5z" />
                    </svg>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" (click)="abrirModal()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 5v14M5 12h14" />
                        </svg>
                        Nuevo Prestamo
                    </button>
                </div>

            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" style="display: inline; margin-right: 5px;">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                    <circle cx="12" cy="7" r="4" />
                                </svg>
                                Cliente
                            </th>
                            <th>

                                Monto</th>
                            <th>

                                Interés</th>
                            <th>

                                Total</th>
                            <th>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" style="display: inline; margin-right: 5px;">
                                    <path
                                        d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" />
                                </svg>
                                Fecha
                            </th>
                            <th>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" style="display: inline; margin-right: 5px;">
                                    <path
                                        d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" />
                                </svg>
                                Fin
                            </th>
                            <th>Estado</th>
                            <th>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" style="display: inline; margin-right: 5px;">
                                    <path
                                        d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                                    <path d="M15 2H9a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1z" />
                                </svg>
                                Descripción
                            </th>
                            <th>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" style="display: inline; margin-right: 5px;">
                                    <path d="M12 20h9M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
                                </svg>
                                Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="loansTableBody">
                        <tr *ngFor="let prestamo of paginatedPrestamos">
                            <td>{{ prestamo.Cliente?.nombre || prestamo.cliente_id }}</td>
                            <td>{{ prestamo.monto | number:'1.2-2' }}</td>
                            <td>{{ prestamo.tasa_interes | number:'1.2-2' }}%</td>
                            <td>{{ prestamo.total_a_pagar | number:'1.2-2' }}</td>
                            <td>{{ prestamo.fecha_inicio | date:'dd/MM/yyyy' }}</td>
                            <td>{{ prestamo.fecha_vencimiento | date:'dd/MM/yyyy' }}</td>
                            <td>
                                <span class="status-badge" [ngClass]="getStatusClass(prestamo.estado)">
                                    {{ prestamo.estado }}
                                </span>
                            </td>
                            <td>{{ prestamo.descripcion }}</td>
                            <td class="actions">
                                <button class="btn btn-success btn-sm" (click)="abrirModal(prestamo)"
                                    title="Editar pago">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M12 20h9M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
                                    </svg>

                                </button>
                                <button class="btn btn-danger btn-sm" (click)="eliminarPrestamo(prestamo.id)"
                                    title="Eliminar pago">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path
                                            d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>


            <div class="pagination" *ngIf="totalPages > 1">
                <button (click)="previousPrestamosPage()" [disabled]="currentPage === 1">&laquo;</button>
                <button *ngFor="let page of getPrestamosPageRange()" (click)="changePrestamosPage(page)"
                    [class.active]="currentPage === page">{{
                    page }}</button>
                <button (click)="nextPrestamosPage()" [disabled]="currentPage === totalPages">&raquo;</button>
            </div>
            <p>{{ getPrestamosPaginationInfo() }}</p>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" [ngClass]="{'show': modalAbierto}" *ngIf="modalAbierto">
        <div class="modal-content">
            <div class="modal-header">
                <h2>{{ modoEdicion ? 'Editar Préstamo' : 'Nuevo Préstamo' }}</h2>
            </div>
            <form id="loanForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="cliente_id">Cliente</label>
                        <select [(ngModel)]="prestamoSeleccionado.cliente_id" name="cliente_id">
                            <option value="0">Seleccione un cliente</option>
                            @for (item of lisClientes; track item.id) {
                            <option [value]="item.id">{{ item.nombre }}</option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="monto">Monto Total</label>
                        <input type="number" id="monto" name="monto" step="0.01" min="0" required
                            [(ngModel)]="prestamoSeleccionado.monto">
                    </div>
                    <div class="form-group">
                        <label for="tasa_interes">Tasa de Interés (%)</label>
                        <input type="number" id="tasa_interes" name="tasa_interes" step="0.01" min="0" max="100"
                            required [(ngModel)]="prestamoSeleccionado.tasa_interes">
                    </div>
                    <div class="form-group">
                        <label for="fecha_inicio">Fecha de Inicio</label>
                        <input type="date" id="fecha_inicio" name="fecha_inicio" required
                            [(ngModel)]="prestamoSeleccionado.fecha_inicio">
                    </div>
                    <div class="form-group">
                        <label for="fecha_vencimiento">Fecha de Vencimiento</label>
                        <input type="date" id="fecha_vencimiento" name="fecha_vencimiento" required
                            [(ngModel)]="prestamoSeleccionado.fecha_vencimiento">
                    </div>
                    <div class="form-group">
                        <label for="estado">Estado</label>
                        <select id="estado" name="estado" [(ngModel)]="prestamoSeleccionado.estado" required>
                            <option value="">Seleccione un estado</option>
                            <option value="Pendiente">Pendiente</option>
                            <option value="Pagado">Pagado</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="descripcion">Descripción</label>
                        <textarea id="descripcion" name="descripcion" [(ngModel)]="prestamoSeleccionado.descripcion"
                            placeholder="Descripción del préstamo"></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" (click)="guardarPrestamo()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M20 6L9 17l-5-5" />
                        </svg>
                        Guardar</button>
                    <button type="button" class="btn btn-secondary" (click)="cerrarModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M18 6L6 18M6 6l12 12" />
                        </svg>
                        Cancelar</button>
                </div>
            </form>
        </div>
    </div>

</body>

</html>